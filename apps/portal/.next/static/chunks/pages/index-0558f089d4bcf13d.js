(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{3454:function(e,t,r){"use strict";var n,s;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(7663)},5557:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(2285)}])},2285:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var n=r(5893),s=r(7294),a=r(3454);function l(){let e="";try{var t;{let t=document.querySelector('meta[name="api-base"]');t&&t.content&&(e=t.content),e||"string"!=typeof window.__APP_API_BASE__||(e=window.__APP_API_BASE__)}!e&&void 0!==a&&(null==a?void 0:null===(t=a.env)||void 0===t?void 0:t.NEXT_PUBLIC_API_BASE_URL)&&(e=a.env.NEXT_PUBLIC_API_BASE_URL)}catch(e){}return"string"!=typeof e&&(e=""),e.replace(/\/$/,"")}let o={PENDING:"PENDING",PROCESSING:"PROCESSING",DONE:"DONE",ERROR:"ERROR"},i=[o.PENDING,o.PROCESSING,o.DONE];function c(){let e=(0,s.useMemo)(()=>l(),[]),[t,r]=(0,s.useState)({headline:"",backgroundUrl:"",newsImageUrl:""}),[a,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(null),[m,h]=(0,s.useState)([]),[x,g]=(0,s.useState)(!1),p=(0,s.useRef)(null),f=e=>{switch(e){case o.PENDING:return{label:"Queued",color:"bg-yellow-100 text-yellow-800"};case o.PROCESSING:return{label:"Processing",color:"bg-blue-100 text-blue-800"};case o.DONE:return{label:"Done",color:"bg-green-100 text-green-800"};case o.ERROR:return{label:"Error",color:"bg-red-100 text-red-800"};default:return{label:e||"Unknown",color:"bg-gray-100 text-gray-800"}}},b=e=>{if(!e)return"";if(e.outputPath)return"Local: ".concat(e.outputPath);if(e.outputUrl)try{let t=new URL(e.outputUrl);if(/(drive|googleusercontent|cloudinary|dropbox|onedrive)/i.test(t.hostname))return"Cloud: ".concat(t.hostname);return"URL: ".concat(e.outputUrl)}catch(t){return"URL: ".concat(e.outputUrl)}return"(No output yet)"},y=e=>{let t=i.indexOf(e);return -1===t?0:t};(0,s.useEffect)(()=>{fetch("".concat(e,"/jobs?limit=1")).then(e=>e.ok?e.json():[]).then(e=>{if(Array.isArray(e)&&e.length){let[t]=e;u(t),t.status!==o.DONE&&t.status!==o.ERROR&&w(t.id)}}).catch(()=>{})},[e]);let v=()=>{p.current&&(clearInterval(p.current),p.current=null)},w=t=>{v(),p.current=setInterval(async()=>{try{let r=await fetch("".concat(e,"/jobs/").concat(t));if(!r.ok)return;let n=await r.json();u(n),h(e=>{let t=e.filter(e=>e.id!==n.id);return[n,...t].slice(0,10)}),(n.status===o.DONE||n.status===o.ERROR)&&v()}catch(e){}},2e3)},N=e=>{let{name:t,value:n}=e.target;r(e=>({...e,[t]:n}))},j=async r=>{var n;if(r.preventDefault(),null===(n=t.headline)||void 0===n?void 0:n.trim()){c(!0);try{let r=await fetch("".concat(e,"/jobs"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({headline:t.headline,background:t.backgroundUrl,newsImage:t.newsImageUrl})});if(!r.ok)throw Error("Failed to create job");let n=await r.json();u(n),h(e=>[n,...e].slice(0,10)),g(!1),w(n.id)}catch(e){console.error(e),alert("Job create করতে সমস্যা হয়েছে. Console চেক করুন.")}finally{c(!1)}}},_=async()=>{try{let t=await fetch("".concat(e,"/jobs?limit=10"));if(!t.ok)return;let r=await t.json();h(Array.isArray(r)?r:[])}catch(e){}},E=async()=>{let e=!x;g(e),e&&0===m.length&&await _()},S=e=>{let{status:t}=e,{label:r,color:s}=f(t);return(0,n.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ".concat(s),children:[(0,n.jsx)("span",{className:"w-2 h-2 rounded-full bg-current opacity-70"}),r]})},P=e=>{let{status:t}=e,r=y(t);return(0,n.jsx)("div",{className:"flex items-center gap-3 select-none",children:i.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-8 h-8 flex items-center justify-center rounded-full text-xs font-bold border \n              ".concat(t<r?"bg-green-600 text-white border-green-600":t===r?"bg-blue-600 text-white border-blue-600":"bg-gray-100 text-gray-500 border-gray-300","\n            "),children:t+1}),t<i.length-1&&(0,n.jsx)("div",{className:"w-10 h-1 rounded ".concat(t<r?"bg-green-600":"bg-gray-200")})]},e))})},T=e=>{var t,r;let{job:s,primary:a}=e;if(!s)return null;let l=b(s);return(0,n.jsxs)("div",{className:"rounded-2xl p-5 shadow-lg border ".concat(a?"bg-white":"bg-gray-50"),children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(S,{status:s.status}),(0,n.jsxs)("span",{className:"text-sm text-gray-500",children:["ID: ",(null===(r=s.id)||void 0===r?void 0:null===(t=r.slice)||void 0===t?void 0:t.call(r,0,8))||s.id]})]}),(0,n.jsx)(P,{status:s.status})]}),(0,n.jsx)("h3",{className:"mt-3 text-xl font-semibold text-gray-900 line-clamp-2",children:s.headline}),(0,n.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsx)("div",{className:"md:col-span-2",children:(0,n.jsx)("div",{className:"relative rounded-xl overflow-hidden border bg-black/5",children:s.outputUrl?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("img",{src:s.outputUrl,alt:"output",className:"w-full h-auto block"}),(0,n.jsxs)("div",{className:"absolute bottom-3 right-3 flex items-center gap-2",children:[(0,n.jsx)("a",{href:s.outputUrl,download:!0,className:"px-3 py-2 rounded-lg bg-white/90 hover:bg-white text-gray-900 shadow font-semibold text-sm",children:"Download"}),(0,n.jsx)("a",{href:s.outputUrl,target:"_blank",rel:"noreferrer",className:"px-3 py-2 rounded-lg bg-gray-900/90 hover:bg-gray-900 text-white shadow font-semibold text-sm",children:"Open"})]})]}):(0,n.jsxs)("div",{className:"p-10 text-center text-gray-500 text-sm",children:["No image yet. The job is ",f(s.status).label,"…"]})})}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"rounded-lg border p-3 bg-white",children:[(0,n.jsx)("div",{className:"text-xs text-gray-500",children:"Storage"}),(0,n.jsx)("div",{className:"text-sm font-medium break-all",children:l}),(s.outputPath||s.outputUrl)&&(0,n.jsx)("button",{onClick:()=>{var e;let t=s.outputPath||s.outputUrl;null===(e=navigator.clipboard)||void 0===e||e.writeText(t)},className:"mt-2 px-2.5 py-1.5 rounded-md text-xs bg-gray-100 hover:bg-gray-200",children:"Copy location"})]}),(0,n.jsxs)("div",{className:"rounded-lg border p-3 bg-white",children:[(0,n.jsx)("div",{className:"text-xs text-gray-500",children:"Created"}),(0,n.jsx)("div",{className:"text-sm font-medium",children:s.createdAt?new Date(s.createdAt).toLocaleString():"—"})]}),s.error&&(0,n.jsx)("div",{className:"rounded-lg border p-3 bg-red-50 text-red-700 text-sm",children:String(s.error)})]})]})]})};return(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white",children:(0,n.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-10",children:[(0,n.jsxs)("header",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-8",children:[(0,n.jsx)("div",{children:(0,n.jsx)("h1",{className:"text-3xl md:text-4xl font-extrabold tracking-tight",children:"\uD83D\uDCF8 PhotoCard Generator 2.0"})}),(0,n.jsx)("div",{className:"text-xs text-gray-500",children:(0,n.jsx)("div",{})})]}),(0,n.jsx)("form",{onSubmit:j,className:"bg-white border rounded-2xl shadow p-6 space-y-4",children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"md:col-span-3",children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Headline"}),(0,n.jsx)("input",{name:"headline",value:t.headline,onChange:N,placeholder:"Write the news headline…",className:"w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Background URL"}),(0,n.jsx)("input",{name:"backgroundUrl",value:t.backgroundUrl,onChange:N,placeholder:"https://…",className:"w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-1",children:"News Image URL"}),(0,n.jsx)("input",{name:"newsImageUrl",value:t.newsImageUrl,onChange:N,placeholder:"https://…",className:"w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"})]}),(0,n.jsx)("div",{className:"flex items-end",children:(0,n.jsx)("button",{type:"submit",disabled:a,className:"w-full md:w-auto inline-flex items-center justify-center gap-2 px-5 py-2.5 rounded-xl bg-red-600 text-white font-semibold shadow hover:bg-red-700 disabled:opacity-60",children:a?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"animate-spin inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),"Creating…"]}):(0,n.jsx)(n.Fragment,{children:"Create Job"})})})]})}),(0,n.jsxs)("section",{className:"mt-8 space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h2",{className:"text-xl font-bold",children:"Latest"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:E,className:"text-sm px-3 py-1.5 rounded-lg border bg-white hover:bg-gray-50",children:x?"Hide History":"Show History"}),(0,n.jsx)("button",{onClick:()=>{h(d?[d]:[]),g(!1)},className:"text-sm px-3 py-1.5 rounded-lg border bg-white hover:bg-gray-50",children:"Clear History"})]})]}),d?(0,n.jsx)(T,{job:d,primary:!0}):(0,n.jsx)("div",{className:"rounded-2xl p-6 border bg-white text-gray-500",children:"No job yet. Create your first PhotoCard."})]}),x&&(0,n.jsxs)("section",{className:"mt-8",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"History (latest 10)"}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:m.map(e=>(0,n.jsx)(T,{job:e},e.id))})]}),(0,n.jsx)("footer",{className:"py-10 text-center text-xs text-gray-400",children:"PhotoCard 2.0 — Dhaka Heralds"})]})})}!function(){if(window.__RAN_API_BASE_TESTS__)return;window.__RAN_API_BASE_TESTS__=!0;let e=document.querySelector('meta[name="api-base"]'),t=()=>{var t;let r=document.querySelector('meta[name="api-base"]');r&&!e&&(null===(t=r.parentNode)||void 0===t||t.removeChild(r))};try{var r;let e;r="http://localhost:4000/",(e=document.querySelector('meta[name="api-base"]'))||((e=document.createElement("meta")).setAttribute("name","api-base"),document.head.appendChild(e)),e.setAttribute("content",r),console.assert("http://localhost:4000"===l(),"[TEST] meta tag should be used and trimmed"),t(),window.__APP_API_BASE__="https://api.example.com/",console.assert("https://api.example.com"===l(),"[TEST] window global should be used and trimmed"),delete window.__APP_API_BASE__,console.assert(""===l(),"[TEST] fallback should be empty string for same-origin")}catch(e){console.warn("[TEST] resolveApiBase tests encountered an error:",e)}finally{t()}}()},7663:function(e){!function(){var t={229:function(e){var t,r,n,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:l}catch(e){r=l}}();var i=[],c=!1,d=-1;function u(){c&&n&&(c=!1,n.length?i=n.concat(i):d=-1,i.length&&m())}function m(){if(!c){var e=o(u);c=!0;for(var t=i.length;t;){for(n=i,i=[];++d<t;)n&&n[d].run();d=-1,t=i.length}n=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===l||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function x(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];i.push(new h(e,t)),1!==i.length||c||o(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=x,s.addListener=x,s.once=x,s.off=x,s.removeListener=x,s.removeAllListeners=x,s.emit=x,s.prependListener=x,s.prependOnceListener=x,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var a=r[e]={exports:{}},l=!0;try{t[e](a,a.exports,n),l=!1}finally{l&&delete r[e]}return a.exports}n.ab="//";var s=n(229);e.exports=s}()}},function(e){e.O(0,[888,774,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);